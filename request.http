# --- VARIABLES ---
# Define la URL base de tu servidor
@baseUrl = http://localhost:3000

# Esta variable guardará el token JWT después del login
@authToken = {{loginRequest.response.body.data.token}}


###
# ===================================================
# REQUERIMIENTO 3: AUTENTICACIÓN (Rutas Públicas)
# ===================================================

### 1. Registrar un nuevo usuario
# (Ejecuta esta petición SOLO UNA VEZ por cada email)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "fullName": "Joan",
  "email": "joan@gmail.com",
  "password": "31240289"
}


### 2. Iniciar Sesión (Login) y Guardar Token
# @name loginRequest
# (Esta petición tiene un @name, lo que permite guardar su respuesta)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "joan@gmail.com",
  "password": "31240289"
}


###
# ===================================================
# REQUERIMIENTO 2: CRUD DE USUARIOS (Rutas Protegidas)
# ===================================================

### 3. Obtener TODOS los usuarios (Protegido)
# (Usa la variable @authToken que guardamos en el login)
GET {{baseUrl}}/users
Authorization: Bearer {{authToken}}


### 4. Obtener UN usuario por ID (Protegido)
# (Reemplaza '1' por el ID del usuario que quieras ver)
GET {{baseUrl}}/users/8
Authorization: Bearer {{authToken}}


### 5. Crear un usuario (Ruta de Admin Protegida)
# (Prueba del POST /users, diferente al registro)
POST {{baseUrl}}/users
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "fullName": "Kelvin Jose",
  "email": "Kelvino@ejemplo.com",
  "password": "password555"
}


### 6. Actualizar UN usuario (Protegido)
# (Actualiza el usuario con ID 1)
PUT {{baseUrl}}/users/1
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "fullName": "Nombre Actualizado (REST Client)"
}


### 7. Borrar UN usuario (Protegido)
# (Borra el usuario con ID 2, el que creó el admin)
DELETE {{baseUrl}}/users/9
Authorization: Bearer {{authToken}}


###
# ===================================================
# REQUERIMIENTO 4: PRUEBA DE FALLO (Seguridad)
# ===================================================

### 8. FALLO - Obtener usuarios SIN token
# (Esta petición debe fallar con un error 401)
GET {{baseUrl}}/users
# (No se envía cabecera de Autorización)


# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 
# ===================== TASK 2 ====================== 
# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 



### 1. Registrar un Usuario (Si no tienes uno creado)
POST http://localhost:3000/auth/register
Content-Type: application/json

{
  "fullName": "Joan",
  "email": "joan@gmail.com",
  "password": "31240289"
}

### 2. Iniciar Sesión (Login)
POST http://localhost:3000/auth/login
Content-Type: application/json

{
  "email": "joan@gmail.com",
  "password": "31240289"
}

### 3. Crear una Categoría (Ruta Protegida)
# ⚠️ IMPORTANTE: Copia el token que te dio el login y pégalo después de "Bearer"
POST http://localhost:3000/categories
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

{
  "name": "Motor",
  "description": "Vielas, pistones, cilindros"
}

### 4. Ver todas las Categorías
GET http://localhost:3000/categories
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

### 5. Eliminar Categorías
DELETE http://localhost:3000/categories/2
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

### 6. Actualizar Categorías
PUT http://localhost:3000/categories/1
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

{
  "description": "Motores, pistones, cilindros, vielas"
}


# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 
# ===================== TASK 2 ====================== 
# ===================--- TAGS ---==================== 
# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 





### Crear un TAG primero (si no tienes)
POST http://localhost:3000/tags
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

{
    "name": "Oferta"
}



### Crear un PRODUCTO (Repuesto)
POST http://localhost:3000/products
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

{
  "name": "Kit de Tiempo Bera SBR 2024",
  "description": "Kit completo",
  "price": 15.99,
  "stock": 50,
  "brand": "Bera Genuine",
  "categoryId": 1,
  "tags": [1],
  "compatibility": "SBR 2024",
  "sku": "KT-BERA-2024"
}

### Actualizar un Producto 
PUT http://localhost:3000/products/1
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

{
  "price": 17.99,
  "stock": 45
}

### Obtener un Producto por ID
GET http://localhost:3000/products/1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

### Eliminar un Producto
DELETE http://localhost:3000/products/1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88




# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 
# ===================== TASK 2 ====================== 
# ===================-- SEARCH --==================== 
# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 



# Ponemos un slug FALSO ("repuesto-viejo") para forzar la redirección.


### Búsqueda Pública (Debería traer tus productos)
GET http://localhost:3000/products?search=Bera

### Prueba de Self-Healing (Redirección)
GET http://localhost:3000/p/1-repuesto-viejo


### Búsqueda Avanzada COMPLETA (Pública)

### Prueba buscar por TAGS (ej: ID 1 y 2) Y Marca
GET http://localhost:3000/products?tags=1,2&brand=Bera Genuine

### Prueba buscar por Compatibilidad (SBR) Y Precio
GET http://localhost:3000/products?compatibility=SBR&price_max=20

### Prueba buscar por SKU (si lo añadiste)
GET http://localhost:3000/products?sku=KT-BERA-2024






# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 
# ===================== TASK 3 ====================== 
# =================================================== 
# =================================================== 
# =================================================== 
# =================================================== 





### Crear Orden y Pagar (Transaccional)
POST http://localhost:3000/orders
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88

{
  "items": [
    { "id": 1, "quantity": 2 }
  ],
  "paymentMethod": "CreditCard",
  "paymentDetails": {
    "cardNumber": "4111111111111111", 
    "cvv": "123",
    "expMonth": "12",
    "expYear": "2030",
    "cardHolder": "APPROVED",
    "currency": "USD"
  }
}


### Obtener Historial de Órdenes (Paginado)
GET http://localhost:3000/orders?page=1&limit=5
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88
Content-Type: application/json


### Obtener Detalle de una Orden (Por ID)
# Reemplaza el '1' al final de la URL por el ID de la orden que quieras ver
GET http://localhost:3000/orders/3
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyfSwiaWF0IjoxNzY1NTEyNDk4LCJleHAiOjE3NjU1MTYwOTh9.KVUScVeT9VHb4KZyWz7UF5CClQdfm-i59m0WQpj1j88
Content-Type: application/json